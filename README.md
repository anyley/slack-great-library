# great-library

### Требования
1. ruby 2.3.1
2. rails 5+

### Установка
```
git clone https://github.com/anyley/great-library.git
cd great-library
bundle install
rails db:setup
```
### Запуск
```
rails s
```
### Основные связи между моделями
```
Item               - Модель содержит книги, скринкасты и прочие
 |- purchase_users - кто скинулся
 |- users          - владельцы ресурса
 |- offered_user   - кто добавил предложение на сайт
 +- claimers       - кто подавал заявки на покупку 

User               - Пользователи библиотеки
 |- purchase_items - какие покупки сделал
 |- items          - владельцем каких ресурсов является
 |- offers         - список предложений пользователя
 +- claim_items    - заявки на покупку
```

### Примеры работы с базой
 ```
# Поиск книги
book = Item.find_by "lower(description) like ?", '%rails%'

# Поиск пользователя
user = User.find_by name: 'SmartDiver'

# Добавить заявку на книгу
user.claim_items << book

# Добавить пользователю заявки на все книги, кроме тех, на которые он уже подавал заявки
user.claim_items << Item.all - user.claim_items

# Очистить список заявок юзера
user.claim_items.delete_all

# Добавить в список заявок все товары
user.claim_items << Item.all

# Посмотреть кто подавал заявки на книгу
book.claimers

# Посмотреть новые заявки на ресурс
book.claimers - book.purchase_users

# Получить спиок линков пользователей для отображения во вьюхе
# вида: user_1, user_2, user_3
<%= map_link_to item.claimers - item.purchase_users, :name %>
```

### Процесс краудфандинга
1. Каждый может добавить в список новый товар
2. Народ подает предварительные заявки на покупку этого товара
3. Любой может запустить краудфандинговую кампанию, нажав на кнопку "Начать сбор денег" и оповестив об этом заинтересованных лиц передав им приватную ссылку на кампанию 
4. По данной ссылке отображается ход кампании по сбору средств
5. Каждый кто хочет приобрести товар должен ввести публичный uuid, который должен предоставить инициатор кампании, что будет являться подтверждением получения реквизитов для перечисления денег, а также подтверждением серьезности намерений приобрести товар
6. Перечислив средства инициатору кампании пользователи должны ввести на сайте операцию перевода средств. с указанием даты и суммы перевода, а полученный uuid отправить инициатору кампании 
7. Инициатор находит в списке операцию перевода средств от пользователя и подписывает её полученным uuid, что будет являться подтверждением того, что они пообщались по этому поводу
8. После получения реальных денег от пользователя, инициатор подтверждает операцию поступления на сайте
9. По окончании сбора средств, инициатор обязан приобрести товар со всеми вытекающими последствиями
10. После приобретения товара, считается, что средства на него собраны в полном объеме и каждая последующая кампания на этот вид товара будет удешевлять его для очередной группы покупателей и образовывать излишки средств для предыдущих покупателей.
11. Образовавшиеся излишки и их держателей можно будет увидеть в личном кабинете
12. Пользователи вправе использовать образующиеся излишки для перенаправления их на покупку других товаров
13. Инициаторы по сбору средств должны осознавать ответственность за сохранность доверенных им денег и своевременно реагировать на их перераспределение при последующих покупках